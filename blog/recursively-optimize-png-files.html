<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" href="/assets/images/icons/favicon.ico"><link rel="author" href="/humans.txt"><link rel="canonical" href="http://blarg.co.uk/blog/recursively-optimize-png-files"><link rel="stylesheet" href="/assets/css/site.css"><title>Recursively Optimize PNG Files - blarg.co.uk</title><link rel="alternate" type="application/rss+xml" title="blarg.co.uk feed" href="http://blarg.co.uk/feed.xml"></head><body><div id="top"><div class="container"><ul class="social pull-right"><li><a href="https://github.com/wrakky" data-toggle="tooltip" data-placement="bottom" title="Github"><i class="fa fa-github"></i></a></li><li><a href="https://twitter.com/wrakky" data-toggle="tooltip" data-placement="bottom" title="Twitter"><i class="fa fa-twitter"></i></a></li><li><a href="http://www.flickr.com/photos/16120271@N03/" data-toggle="tooltip" data-placement="bottom" title="Flickr"><i class="fa fa-flickr"></i></a></li></ul></div></div><header id="header" class="container"><div class="navbar navbar-default" role="navigation"><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-links"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/">blarg.co.uk</a></div><div class="collapse navbar-collapse" id="navbar-links"><ul class="nav navbar-nav navbar-right"><li><a href="/blarg/">Blarg</a></li><li class="active"><a href="/blog/">Blog</a></li><li><a href="/tools/">Tools</a></li><li><a href="/astronomy/">Astronomy</a></li></ul></div></div></div></header><div id="page" class="container page-blog"><div id="breadcrumbs" class="clearfix"><div class="container-fluid"><h1 class="pull-left">Recursively Optimize PNG Files</h1></div></div><div class="row"><div id="content" class="col-md-9"><div class="info"><div class="pull-left"><i class="fa fa-calendar"></i> 28th March 2014</div><div class="pull-right"><i class="fa fa-comments"></i> <a href="/blog/recursively-optimize-png-files#disqus_thread"></a></div></div><br class="clearfix"><div class="article"><p>One way to improve performance and reduce bandwidth for your website is to make sure your image files are properly optimised. It’s an easy win for not much work so there’s no excuse for not doing it - especially when it can all be done losslessly with the end result will looking exactly the same as the original with no loss of quality.</p><p>If you are looking at doing this for the first time you probably have a great big folder of images which also contains sub-folders and sub-sub-folders of even more images and will want to optimize them all. In this article I look at using OptiPNG and PNGCrush, two of the most commonly used png optimizers, and see how you can use them to quickly optimize all of the images recursively in a directory.</p><h2 id="optipng">OptiPNG</h2><p>OptiPNG will automatically overwrite any files it finds which means we can do everything in a single command. Handy!</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /path/to/your/images
find -name <span class="s1">'*.png'</span> -print0 | xargs -0 optipng -nc -nb -o7</code></pre></div><h3 id="how-it-works">How it Works</h3><p>You will want to run this command in your images directory so first navigate to it. The command first uses <code>find</code> to gather a list of all files ending in .png in the current directory (and sub-directories). It then uses <code>xargs</code> to append this list of files to the end of the <code>optipng</code> command which will process them all.</p><p>The arguments <code>-nc -nb</code> tell optipng not to alter any colour information (or we risk changing the appearance of the optimized image) and <code>-o7</code> tells it to use the best compression.</p><h2 id="pngcrush">PNGCrush</h2><p>Unfortunately, PNGCrush will not overwrite any images which makes things a bit tricker. We will need to write a small bash script to do the work for us instead.</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/sh</span>

<span class="c"># loop through all files ending in .png</span>
<span class="k">for </span>file <span class="k">in</span> <span class="sb">`</span>find -name <span class="s1">'*.png'</span><span class="sb">`</span>
<span class="k">do</span>

  <span class="c"># crush image and save it's output</span>
  pngcrush -reduce -brute <span class="nv">$file</span> /tmp/crushed.png

  <span class="c"># overwrite original image with crushed version</span>
  mv /tmp/crushed.png <span class="nv">$file</span>

<span class="k">done</span></code></pre></div><h3 id="how-it-works-1">How it Works</h3><p>Save the script somewhere and make it executable (<code>chmod a+x [script.sh]</code>). Navigate to your images directory and run the script.</p><p>It uses <code>find</code> to gather a list of all files ending in .png in the current directory (and sub-directories), loops through them all and runs <code>pngcrush</code> on each file. The optimized file is then saved in <code>/tmp/crushed.png</code> and immediately replaces the original file.</p><p>The pngcrush arguments used are <code>-reduce</code> which tells it to do lossless compression and <code>-brute</code> which will try 126 different crushing methods for maximum compression.</p></div><hr><div id="share"><h3>Share This Page</h3><div class="link-group"><a data-network="twitter" class="social-share btn btn-info" href="https://twitter.com/share?text=Recursively Optimize PNG Files&url=http://blarg.co.uk/blog/recursively-optimize-png-files" rel="popup"><i class="fa fa-twitter"></i> <span>Share on</span>Twitter</a></div><div class="link-group"><a data-network="facebook" class="social-share btn btn-primary" href="https://www.facebook.com/sharer/sharer.php?u=http://blarg.co.uk/blog/recursively-optimize-png-files" rel="popup"><i class="fa fa-facebook-square"></i> <span>Share on</span>Facebook</a></div><div class="link-group"><a data-network="googleplus" class="social-share btn btn-danger" href="https://plus.google.com/share?url=http://blarg.co.uk/blog/recursively-optimize-png-files" rel="popup"><i class="fa fa-google-plus"></i> <span>Share on</span>Google+</a></div></div><hr><h3>Join in the Discussion</h3><div id="disqus_thread"></div><script type="text/javascript">

  /* * * CONFIGURATION VARIABLES * * */
  var disqus_shortname = "blargcouk";

  /* * * DISQUS SCRIPT * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();

</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><script type="text/javascript">

  /* * * CONFIGURATION VARIABLES * * */
  var disqus_shortname = "blargcouk";

  /* * * DISQUS SCRIPT * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();

</script></div><div id="sidebar" class="col-md-3"><div class="sidebar-box"><div class="title"><h2><i class="fa fa-share"></i> Share This Page</h2></div><div><a data-network="twitter" class="social-share btn btn-info btn-sm" href="https://twitter.com/share?text=Recursively Optimize PNG Files&url=http://blarg.co.uk/blog/recursively-optimize-png-files" rel="popup"><i class="fa fa-twitter"></i> Twitter</a> <a data-network="facebook" class="social-share btn btn-primary btn-sm" href="https://www.facebook.com/sharer/sharer.php?u=http://blarg.co.uk/blog/recursively-optimize-png-files" rel="popup"><i class="fa fa-facebook-square"></i> Facebook</a> <a data-network="googleplus" class="social-share btn btn-danger btn-sm" href="https://plus.google.com/share?url=http://blarg.co.uk/blog/recursively-optimize-png-files" rel="popup"><i class="fa fa-google-plus"></i> Google+</a></div></div><div class="sidebar-box"><div class="title"><h2><i class="fa fa-arrow-circle-right"></i> Lastest From the Blog</h2></div><ul class="list-group"><li class="list-group-item"><a href="/blog/comparison-of-jpeg-lossless-compression-tools">Comparison of JPEG Lossless Compression Tools</a></li><li class="list-group-item"><a href="/blog/how-to-install-mozjpeg">How to Install mozjpeg</a></li><li class="list-group-item"><a href="/blog/recursively-optimize-png-files">Recursively Optimize PNG Files</a></li><li class="list-group-item"><a href="/blog/javascript-date-formats">Javascript Date Formats</a></li><li class="list-group-item"><a href="/blog/automatically-collapse-firephp-responses">Automatically Collapse FirePHP Responses</a></li></ul></div><div class="sidebar-box"><div class="title"><h2><i class="fa fa-cogs"></i> Tools</h2></div><ul class="list-group"><li class="list-group-item"><a href="/tools/page-ruler"><img class="icon" src="/assets/images/browser/chrome.png"> Page Ruler</a><p>Draw a ruler to get pixel dimensions and positioning on any page</p></li><li class="list-group-item"><a href="/tools/robots-vs-humans"><img class="icon" src="/assets/images/browser/chrome.png"> Robots vs Humans</a><p>Display robots.txt and humans.txt files on any website</p></li><li class="list-group-item"><a href="/astronomy/barn-door-tracker-calculator"><img class="icon" src="/assets/images/astronomy/telescope.png"> Barn Door Tracker Calculator</a><p>Quickly calculate the distance between the hinge and drive bolt</p></li></ul></div><div class="sidebar-box"><div class="title"><h2><i class="fa fa-twitter"></i> Latest Tweets</h2></div><div class="tweets"><p class="loading"><i class="fa fa-spinner fa-spin"></i> Loading tweets...</p></div><a href="https://twitter.com/wrakky" class="btn btn-info btn-sm btn-block"><i class="fa fa-twitter"></i> Follow me on Twitter</a></div><script>window.TWEET_TYPE = 'mine';</script><div class="sidebar-box"><div class="title"><h2><i class="fa fa-flickr"></i> Photostream</h2></div><div class="photostream"><p class="loading"><i class="fa fa-spinner fa-spin"></i> Loading photostream...</p></div><a href="https://www.flickr.com/photos/16120271@N03/" class="btn btn-success btn-sm btn-block"><i class="fa fa-flickr"></i> Follow me on Flickr</a></div><script>window.PHOTOSTREAM = true;</script></div></div><div class="clearfix"></div></div><footer id="footer" class="container"><div class="navbar navbar-inverse"><div class="container-fluid"><p class="navbar-text">Copyright &copy; 2015 <a href="/" class="navbar-link">blarg.co.uk</a>. All rights reserved.</p><p class="navbar-text pull-right">Hosted on <a href="https://github.com/wrakky/blarg.co.uk" class="navbar-link">Github</a>, Powered by <a href="http://jekyllrb.com/" class="navbar-link">Jekyll</a></p></div></div></footer><script src="/assets/js/libs.js"></script><script src="/assets/js/site.js"></script></body></html>